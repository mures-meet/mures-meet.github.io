AOS.init({
	duration: 800,
	easing: 'ease',
	once: true,
	offset: 120
});

jQuery(function($) {
   
   'use strict';
   loader();
   languageSelector();
   siteMenuClone();
   mobileToggleClick();
   onePageNavigation();
   siteIstotope();
   portfolioItemClick();
   owlCarouselPlugin();
   floatingLabel();
   scrollWindow();
   counter();
   jarallaxPlugin();
   contactForm();
   stickyFillPlugin();
   animateReveal();

});

var siteIstotope = function() {
   var $container = $('#posts').isotope({
   itemSelector : '.item',
   isFitWidth: true
 });

 $(window).resize(function(){
   $container.isotope({
	 columnWidth: '.col-sm-3'
   });
 });
 
 $container.isotope({ filter: '*' });

 $('#filters').on( 'click', 'a', function(e) {
	 e.preventDefault();
   var filterValue = $(this).attr('data-filter');
   $container.isotope({ filter: filterValue });
   $('#filters a').removeClass('active');
   $(this).addClass('active');
 });

 $container.imagesLoaded()
 .progress( function() {
   $container.isotope('layout');
 })
 .done(function() {
	 $('.gsap-reveal-img').each(function() {
		   var html = $(this).html();
		   $(this).html('<div class="reveal-wrap"><span class="cover"></span><div class="reveal-content">'+html+'</div></div>');
	   });

	 var controller = new ScrollMagic.Controller();

	 var revealImg = $('.gsap-reveal-img');

	 if ( revealImg.length ) {
		 var i = 0;
		   revealImg.each(function() {

			   var cover = $(this).find('.cover'),
				   revealContent = $(this).find('.reveal-content'),
				   img = $(this).find('.reveal-content img');


			   var tl2 = new TimelineMax();


			   setTimeout(function() {

				   tl2
					   tl2.set(img, {  scale: '2.0', autoAlpha: 1, })
					   .to(cover, 1, { marginLeft: '0', ease:Expo.easeInOut, onComplete() {
						   tl2.set(revealContent, { autoAlpha: 1 });
						   tl2.to(cover, 1, { marginLeft: '102%', ease:Expo.easeInOut });
						   tl2.to(img, 2, { scale: '1.0', ease:Expo.easeOut }, '-=1.5');
					   } } )

			   }, i * 700);

			   

			   var scene = new ScrollMagic.Scene({
				   triggerElement: this,
				   duration: "0%",
				   reverse: false,
				   offset: "-300%",
			   })
			   .setTween(tl2)
			   .addTo(controller);

			   i++;

		   });
	   }
 })

 $('.js-filter').on('click', function(e) {
	 e.preventDefault();
	 $('#filters').toggleClass('active');
 });

}

var loader = function() {
   // Use only TweenMax for smooth animation
   setTimeout(function() {
       TweenMax.to('.loader-wrap', 1, { 
           autoAlpha: 0, 
           ease: Power4.easeInOut,
           onComplete: function() {
			   // Hide the element completely after animation
			   // $('.loader-wrap').css('display', 'none');
           }
       });
   }, 1000);
   
   // Remove the conflicting jQuery fadeOut
   // $(".loader-wrap").delay(400).fadeOut("slow");
}

// Language translations
const translations = {
  ro: {
	"menu": "Meniu",
	"nav.top": "Introducere",
	"nav.about": "Despre Mure탳 Carmeet",
	"nav.carmeets": "Car meet-uri",
	"nav.events": "Evenimente auto selecte",
	"nav.social": "Social media",
	"nav.contact": "Contact",
	"nav.menu-close": "칉nchide",
	"cover.header": "Meet-uri 탳i evenimente auto private<br>칥n T칙rgu Mure탳",
	"swipe-up": "Glisa탵i 칥n sus",
	"intro.header": "Introducere",
	"about.header": "Despre <span style=\"font-family: 'FerroRosso';\">Mure탳 Carmeet</span>",
	"about.info1": "Comunitatea <span style=\"font-family: 'FerroRosso';\">Mure탳 Carmeet</span> a luat na탳tere 칥n 2023 la ini탵iativa form캒rii unei comunit캒탵i auto selecte 칥n T칙rgu Mure탳.",
	"about.info2": "Din 2023 p칙n캒 칥n prezent meet-urile sunt organizate periodic la un interval de 2 - 3 s캒pt캒m칙ni 칥n timpul sezonului cald, iar o dat캒 pe lun캒 칥n timpul sezonului rece, 칥n diferite loca탵ii din ora탳.",
	"meets.header": "Despre meet-uri",
	"meets.info": "Meet-urile organizate 칥n comunitatea Mure탳 Carmeet sunt 칥nt칙lniri auto private organizate 칥n diferite loca탵ii din T칙rgu Mure탳. Acestea sunt ocazii excelente pentru pasiona탵ii auto de a se 칥nt칙lni, a cunoa탳te oameni noi, a socializa 탳i a 칥mp캒rt캒탳i pasiunea pentru automobile.",
	"events.header": "Evenimente auto selecte",
	"collab.header": "Colaboratori evenimente auto selecte",
	"events.info": "Evenimentele selecte sunt organizate doar 칥n timpul sezonului cald prim캒var캒-toamn캒, la una din loca탵iile colaboratorilor no탳tri.",
	"event.royal": "Eveniment Royal Car Wash",
	"socials.header": "Metode oficiale de contact",
	"socials.info": "Pentru a afla detaliile meet-urilor, precum loca탵ia, data 탳i ora meet-ului, exist캒 2 metode:",
	"socials.info1": "1. Urm캒rirea paginii oficiale <span style=\"font-family:'FerroRosso';\">Mure탳 Carmeet</span> de pe platforma preferat캒 de socializare din cele de mai jos (este necesar캒 trimiterea unui mesaj privat cu modelul ma탳inii pentru a fi ad캒ugat 칥n lista de Close Friends).",
	"socials.info2": "2. Pentru cei care nu folosesc social media, prin completarea formularului din sec탵iunea de <a href='#contact-section' class=\"smoothscroll\" style=\"font-family:'SerpentineSansICG-BoldOblique';\">Contact</a>, pentru a primii detaliile fiec캒rui meet printr-un mesaj pe WhatsApp, Facebook Messenger sau SMS.",
	"social.bio1": "Meet-uri 탳i evenimente auto locale private,",
	"social.bio2": "organizate 칥n T칙rgu Mure탳, Rom칙nia游늸",
	"social.bio3": "칥ncep칙nd din 2023",
	"social.insta-info": "Pe <span class=\"bold\"><span class=\"wrap-icon icon-instagram\"></span>&emsp14;Instagram</span>, meet-urile sunt anun탵ate la <span class=\"bold\">Private Story</span> pentru cei care urm캒resc pagina <span style=\"font-family:'FerroRosso';\">Mure탳 Carmeet</span> 탳i sunt inclu탳i 칥n lista de <span class=\"bold\">Close Friends/Prieteni apropia탵i</span>.",
	"social.fb-info": "Pe <span class=\"bold\"><span class=\"wrap-icon icon-facebook-square\"></span>&emsp14;Facebook</span>, meet-urile sunt anun탵ate pe <span class=\"bold\">Story Privat</span> pentru cei ad캒uga탵i 칥n lista de <span class=\"bold\">Prieteni apropia탵i.</span>",
	"wapp.info": "칉n cazul 칥n care nu folosi탵i aplica탵iile <span class=\"bold\"><span class=\"wrap-icon icon-instagram\"></span>&emsp14;Instagram</span> sau <span class=\"bold\"> <span class=\"wrap-icon icon-facebook-square\"></span>&emsp14;Facebook</span>, ne pute탵i contacta pe <span class=\"bold\"><span class=\"wrap-icon icon-whatsapp\"></span>&emsp14;WhatsApp</span> pe butonul de mai sus cu un mesaj care s캒 con탵in캒 modelul ma탳inii sau la completarea formularului de contact de mai jos, ve탵i primi pe <span class=\"bold\">WhatsApp, Facebook Messenger sau prin SMS</span> detaliile despre fiecare meet precum  loca탵ia, data 탳i ora.",
	"contact.header": "Contact",
	"contact.info": "Pentru a primii detaliile fiec캒rui meet sau eveniment, precum loca탵ia, data 탳i ora, este necesar s캒 completa탵i fie prenumele sau porecla, modelul ma탳inii 탳i metoda de contact preferat캒 din cele de mai jos:",
	"form.name": "Prenume <span style=\"text-transform:lowercase;\">sau</span> Porecl캒*",
	"form.car-model": "Modelul Ma탳inii<span class='bold'>*</span>",
	"form.whatsapp": "WhatsApp &nbsp;|&nbsp; Telefon",
	"form.message": "Mesaj... <span style='text-transform:capitalize;'>(Op탵ional)</span>",
	"form.important": "Important: Este necesar s캒 completa탵i toate c칙mpurile marcate cu asterisc <span class='bold'>*</span>.",
	"form.info": "Datele completate 칥n formularul de mai sus sunt confiden탵iale 탳i nu vor fi redistribuite, v칙ndute sau postate 칥n alt캒 parte.",
	"send.button": "Trimite &nbsp;<span class=\"icon-send2\"></span>",
	// ...add all other keys for RO
  },
  en: {
	"menu": "Menu",
	"nav.top": "Introduction",
	"nav.about": "About Mures Carmeet",
	"nav.carmeets": "Car meets",
	"nav.events": "Select Car events",
	"nav.social": "Social media",
	"nav.contact": "Contact",
	"nav.menu-close": "Close",
	"cover.header": "Private local car meets and events<br>in Targu Mures",
	"swipe-up": "Swipe up",
	"intro.header": "Introduction",
	"about.header": "About <span style=\"font-family: 'FerroRosso';\">Mures Carmeet</span>",
	"about.info1": "The <span style=\"font-family: 'FerroRosso';\">Mures Carmeet</span> community was born in 2023 with the aim of creating a select car community in Targu Mures.",
	"about.info2": "Since 2023, the meets are organized periodically every 2 - 3 weeks during the warm season, and once a month during the cold season, in different locations around the city.",
	"meets.header": "About meets",
	"meets.info": "The meets organized by the Mures Carmeet community are private car meets organized in different locations in Targu Mure탳. They are great opportunities for car enthusiasts to meet new people, socialize, and share their passion for cars.",
	"events.header": "Select car events",
	"collab.header": "Private car events collaborators",
	"events.info": "The select car events are organized only during the warm season spring-autumn, at one of our collaborators' locations.",
	"event.royal": "Royal Car Wash event",
	"socials.header": "Official contact methods",
	"socials.info": "To find out the details of the meets, such as the location, date and time of the meet, there are 2 methods:",
	"socials.info1": "1. Following the official <span style=\"font-family:'FerroRosso';\">Mures Carmeet</span> page on your preferred social media platform from the ones below (it's required to send us a private message with your car model to be added to the Close Friends list)",
	"socials.info2": "2. For those who do not use social media, by filling out the form in the <a href='#contact-section' class=\"smoothscroll\" style=\"font-family:'SerpentineSansICG-BoldOblique';\">Contact</a> section, you will receive the details of each meet via a message on WhatsApp, Facebook Messenger or SMS.",
	"social.bio1": "Private local car meets and events,",
	"social.bio2": "based in Targu Mures, Romania游늸",
	"social.bio3": "since 2023",
	"social.insta-info": "On <span class=\"bold\"><span class=\"wrap-icon icon-instagram\"></span>&emsp14;Instagram</span>, the meets are announced in the <span class=\"bold\">Private Story</span> for those who follow the <span style=\"font-family:'FerroRosso';\">Mures Carmeet</span> page and are included in the <span class=\"bold\">Close Friends</span> list.",
	"social.fb-info": "On <span class=\"bold\"><span class=\"wrap-icon icon-facebook-square\"></span>&emsp14;Facebook</span>, the meets are announced on <span class=\"bold\">Private Story</span> for those who are included in the <span class=\"bold\">Close Friends list.</span>",
	"wapp.info": "In case you do not use the <span class=\"bold\"><span class=\"wrap-icon icon-instagram\"></span> Instagram</span> or <span class=\"bold\"> <span class=\"wrap-icon icon-facebook-square\"></span> Facebook</span> apps, you can contact us on <span class=\"bold\"><span class=\"wrap-icon icon-whatsapp\"></span>&emsp14;WhatsApp</span> by pressing the button above with a message containing your car model or by filling out the contact form below, you will receive the details about each meet such as location, date and timeon <span class=\"bold\">WhatsApp, Facebook Messenger or via SMS.</span>",
	"contact.header": "Contact",
	"contact.info": "To receive the details of each meet or event like the location, date and time, please provide your first name or alias, car model and preferred contact method from the ones listed below:",
	"form.name": "First Name <span style=\"text-transform:lowercase;\">or</span> Alias*",
	"form.car-model": "Car Model*",
	"form.whatsapp": "WhatsApp &nbsp;|&nbsp; Phone",
	"form.message": "Message... <span style='text-transform:capitalize;'>(Optional)</span>",
	"form.important": "Important: It is required to fill in all fields marked with asterisk <span class='bold'>*</span>.",
	"form.info": "All data completed in the form above is confidential and wont be redistributed, sold or posted anywhere else.",
	"send.button": "Send &nbsp;<span class=\"icon-send2\"></span>",
	// ...add all other keys for EN
  },
  hu: {
	"menu": "Men칲",
	"nav.top": "Bevezet칠s",
	"nav.about": "R칩lunk Mure탳 Carmeet",
	"nav.carmeets": "Aut칩s tal치lkoz칩k",
	"nav.events": "Aut칩s esem칠nyek",
	"nav.social": "K칬z칬ss칠gi m칠dia",
	"nav.contact": "Kapcsolat",
	"nav.menu-close": "Bez치r치s",
	"cover.header": "Priv치t aut칩s tal치lkoz칩k 칠s esem칠nyek<br>Marosv치s치rhely-ben",
	"swipe-up": "G칬rgesd felfel칠",
	"intro.header": "Bevezet칠s",
	"about.header": "R칩lunk <span style=\"font-family: 'FerroRosso';\">Mure탳 Carmeet</span>",
	"about.info1": "A <span style=\"font-family: 'FerroRosso';\">Mure탳 Carmeet</span> k칬z칬ss칠g 2023-ban alakult azzal a c칠llal, hogy egy kiv치lasztott aut칩s k칬z칬ss칠get hozzon l칠tre Marosv치s치rhely-ben.",
	"about.info2": "2023 칩ta a tal치lkoz칩kat id콈szakosan, 2-3 hetente szervezik a meleg 칠vszakban, 칠s havonta egyszer a hideg 칠vszakban, a v치ros k칲l칬nb칬z콈 helysz칤nein.",
	"meets.header": "Aut칩s tal치lkoz칩k",
	"meets.info": "A Mure탳 Carmeet k칬z칬ss칠g 치ltal szervezett tal치lkoz칩k priv치t aut칩s tal치lkoz칩k, amelyeket Marosv치s치rhely k칲l칬nb칬z콈 helysz칤nein szerveznek. Kiv치l칩 lehet콈s칠get k칤n치lnak az aut칩rajong칩k sz치m치ra, hogy 칰j emberekkel tal치lkozzanak, szocializ치l칩djanak 칠s megossz치k szenved칠ly칲ket az aut칩k ir치nt.",
	"events.header": "Kiv치lasztott aut칩s esem칠nyek",
	"collab.header": "Priv치t aut칩s esem칠nyek egy칲ttm콤k칬d콈k",
	"events.info": "A kiv치lasztott aut칩s esem칠nyeket csak a meleg 칠vszakban szervezik tavasz-콈sz, az egy칲ttm콤k칬d콈ink egyik helysz칤n칠n.",
	"event.royal": "Royal Car Wash esem칠ny",
	"socials.header": "Hivatalos kapcsolattart치si m칩dok",
	"socials.info": "A tal치lkoz칩k r칠szleteinek, p칠ld치ul a helysz칤n, d치tum 칠s id콈 megismer칠s칠hez k칠t m칩dszer l칠tezik:",
	"socials.info1": "1. K칬vesd a hivatalos <span style=\"font-family:'FerroRosso';\">Mure탳 Carmeet</span> oldalt a kedvenc k칬z칬ss칠gi m칠dia platformodon az al치bbiak k칬z칲l (sz칲ks칠ges, hogy k칲ldj nek칲nk egy priv치t 칲zenetet az aut칩d modellj칠vel, hogy felvegy칲nk a Close Friends list치ra)",
	"socials.info2": "2. Azok sz치m치ra, akik nem haszn치lj치k a k칬z칬ss칠gi m칠di치t, a <a href='#contact-section' class=\"smoothscroll\" style=\"font-family:'SerpentineSansICG-BoldOblique';\">Kapcsolat</a> szakaszban tal치lhat칩 콤rlap kit칬lt칠s칠vel megkapod a tal치lkoz칩k r칠szleteit egy 칲zenetben a WhatsApp, Facebook Messenger vagy SMS.",
	"social.bio1": "Priv치t helyi aut칩s tal치lkoz칩k 칠s esem칠nyek,",
	"social.bio2": "Marosv치s치rhely-ben, Rom치ni치ban游늸",
	"social.bio3": "2023 칩ta",
	"social.insta-info": "Az <span class=\"bold\"><span class=\"wrap-icon icon-instagram\"></span>&emsp14;Instagram</span> platformon a tal치lkoz칩kat a <span class=\"bold\">Priv치t Story-ban</span> jelentik be azok sz치m치ra, akik k칬vetik a <span style=\"font-family:'FerroRosso';\">Mure탳 Carmeet</span> oldalt 칠s szerepelnek a <span class=\"bold\">K칬zeli bar치tok list치n.</span>",
	"social.fb-info": "A <span class=\"bold\"><span class=\"wrap-icon icon-facebook-square\"></span>&emsp14;Facebook</span> platformon a tal치lkoz칩kat a <span class=\"bold\">Priv치t Story-ban</span> jelentik be azok sz치m치ra, akik szerepelnek a <span class=\"bold\">K칬zeli bar치tok list치n.</span>",
	"wapp.info": "Abban az esetben, ha nem haszn치lod az <span class=\"bold\"><span class=\"wrap-icon icon-instagram\"></span> Instagram</span> vagy a <span class=\"bold\"> <span class=\"wrap-icon icon-facebook-square\"></span> Facebook</span> alkalmaz치sokat, kapcsolatba l칠phetsz vel칲nk a <span class=\"bold\"><span class=\"wrap-icon icon-whatsapp\"></span>&emsp14;WhatsApp</span> alkalmaz치son kereszt칲l a fenti gombra kattintva egy 칲zenettel, amely tartalmazza az aut칩d modellj칠t, vagy kit칬ltheted az al치bbi kapcsolatfelv칠teli 콤rlapot, 칠s megkapod a tal치lkoz칩k r칠szleteit, p칠ld치ul a helysz칤nt, d치tumot 칠s id콈t a <span class=\"bold\">WhatsApp-on, Facebook Messenger-en vagy SMS-ben.</span>",
	"contact.header": "Kapcsolat",
	"contact.info": "A tal치lkoz칩k vagy esem칠nyek r칠szleteinek, p칠ld치ul a helysz칤n, d치tum 칠s id콈 megismer칠s칠hez k칠rj칲k, add meg keresztneved vagy 치lneved, aut칩d modellj칠t 칠s a prefer치lt kapcsolattart치si m칩dot az al치bbiak k칬z칲l:",
	"form.name": "Keresztn칠v <span style=\"text-transform:lowercase;\">vagy</span> 츼ln칠v*",
	"form.car-model": "Aut칩 T칤pusa*",
	"form.whatsapp": "WhatsApp &nbsp;|&nbsp; Telefon",
	"form.message": "칖zenet... <span style='text-transform:capitalize;'>(Opcion치lis)</span>",
	"form.important": "Fontos: K칠rj칲k, t칬ltsd ki az 칬sszes csillag <span class='bold'>*</span>-gal jel칬lt mez콈t.",
	"form.info": "A fenti 콤rlapban megadott adatok bizalmasak, 칠s nem ker칲lnek 칰jra terjeszt칠sre, elad치sra vagy m치shol k칬zz칠t칠telre.",
	"send.button": "K칲ld칠s &nbsp;<span class=\"icon-send2\"></span>",
	// ...add all other keys for HU
  }
};

/**
 * Sets the website language and updates all elements with translations.
 * @param {string} lang - The language code to set (e.g., 'ro', 'en', 'hu').
 * Side effects: Updates localStorage, changes document lang attribute, and modifies DOM elements with [data-i18n].
 */
function setLanguage(lang) {
    if (!translations[lang]) {
        console.warn(`Language '${lang}' not supported`);
        return;
    }
    localStorage.setItem('selectedLang', lang);
    document.documentElement.setAttribute('lang', lang);
    
    // Remove existing GSAP covers before updating content
    $('.gsap-reveal .cover').remove();
    
    document.querySelectorAll('[data-i18n]').forEach(function(el) {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
                el.innerHTML = translations[lang][key];
        } else {
            console.warn(`Missing translation for key: '${key}' in language: '${lang}'`);
            el.innerHTML = `Translation missing: ${key}`;
        }
    });
    
    // Re-initialize GSAP animations after content update
    setTimeout(function() {
        animateReveal();
        // Refresh AOS as well in case some elements need it
        AOS.refresh();
    }, 100);
}

// On page load, check if language is already selected
window.addEventListener('DOMContentLoaded', function() {
	let lang = localStorage.getItem('selectedLang');
	if (lang && translations[lang]) {
		// Language already selected, apply it and fade out overlay
		setLanguageAndUpdateNav(lang);
		$("#preloader-overlay").fadeOut(1000);
	} else {
		// First time visit, fade in language selection overlay
		$("#preloader-overlay").fadeIn(500);
	}
});

// Update the languageSelector function
function languageSelector() {
    document.querySelectorAll('.lang-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const lang = btn.dataset.lang;
            if (lang && translations[lang]) {
                setLanguageAndUpdateNav(lang);
                // Fade out the overlay smoothly
                $("#preloader-overlay").fadeOut(500);
            }
        });
    });
}

// Update the nav language button click handler
document.addEventListener("DOMContentLoaded", function() {
    updateNavLangSelector();
    const overlay = document.getElementById("preloader-overlay");
    const langBtns = overlay.querySelectorAll('.lang-btn');
    
    document.getElementById("current-lang-btn").addEventListener("click", function(e) {
        e.preventDefault();
        
        // Show overlay with fade
        $(overlay).fadeIn(500);
        
        // Reset button positions and animate them in
        TweenMax.set(langBtns, { z: 50, opacity: 0 });
        
        // Animate buttons in with stagger
        TweenMax.staggerTo(langBtns, 0.8, {
            y: 0,
            opacity: 1,
            ease: Power3.easeOut,
            delay: 0.3
        }, 0.2);
    });
});

// Update the nav language button click handler
document.addEventListener("DOMContentLoaded", function() {
    updateNavLangSelector();
    const overlay = document.getElementById("preloader-overlay");
    document.getElementById("current-lang-btn").addEventListener("click", function(e) {
        e.preventDefault();
        // Fade in the overlay smoothly
        $(overlay).fadeIn(500);
    });
});

function updateNavLangSelector() {
	const lang = localStorage.getItem('selectedLang');
	if (!lang) return; // Don't update if no language selected yet
	
	const flagMap = {
		ro: "images/Romanian.png",
		en: "images/English.png",
		hu: "images/Magyar.png"
	};
	const flag = flagMap[lang];
	if (flag) {
		document.getElementById("current-lang-flag").src = flag;
	}
}

// Show overlay when nav language button is pressed
document.addEventListener("DOMContentLoaded", function() {
	updateNavLangSelector();
	document.getElementById("current-lang-btn").addEventListener("click", function(e) {
		e.preventDefault();
		document.getElementById("preloader-overlay").style.display = "flex";
	});
});

// Wrapper function to extend setLanguage behavior
function setLanguageAndUpdateNav(lang) {
	setLanguage(lang);
	updateNavLangSelector();
}

// Move the following block into siteMenuClone function for proper initialization
var siteMenuClone = function() {
  $('.js-clone-nav').each(function() {
	var $this = $(this);
	$this.clone().attr('class', 'site-nav-wrap').appendTo('.site-mobile-inner');
  });

//   var counter = 0;
//   $('.site-mobile-menu .has-children').each(function(){
// 	var $this = $(this);

// 	$this.prepend('<span class="arrow-collapse collapsed">');

// 	$this.find('.arrow-collapse').attr({
// 	  'data-toggle' : 'collapse',
// 	  'data-target' : '#collapseItem' + counter,
// 	});

// 	$this.find('> ul').attr({
// 	  'class' : 'collapse',
// 	  'id' : 'collapseItem' + counter,
// 	});

// 	counter++;
//   });

  $('body').on('click', '.arrow-collapse', function(e) {
	var $this = $(this);
	if ( $this.closest('li').find('.collapse').hasClass('show') ) {
	  $this.removeClass('active');
	} else {
	  $this.addClass('active');
	}
	e.preventDefault();  
  });

  $(window).resize(function() {
	var $this = $(this),
		w = $this.width();

	if ( w > 768 ) {
	  if ( $('body').hasClass('offcanvas') ) {
		$('body').removeClass('offcanvas');
	  }
	}
  });

  $('.js-burger-toggle-menu').click(function(e){
	e.preventDefault();
	if ( $('body').hasClass('offcanvas') ) {
	  $('body').removeClass('offcanvas');
	  $('.js-burger-toggle-menu').removeClass('open');
	} else {
	  $('body').addClass('offcanvas');	
	  $('.js-burger-toggle-menu').addClass('open');
	}
  });
};




// var siteIstotope = function() {


	 
   
// }

var owlCarouselPlugin = function() {

   $('.testimonial-slider').owlCarousel({
   center: false,
   items: 1,
   loop: true,
   stagePadding: 20,
	 margin: 10,
   smartSpeed: 2000,
   autoplay: true,
   autoplayHoverPause: true,
   dots: true,
   nav: true,
   navText: ['<span class="icon-keyboard_arrow_left">', '<span class="icon-keyboard_arrow_right">'],

   responsive:{
	   400:{
		 stagePadding: 20,
				 margin: 10,
	   },
	   600:{
		 stagePadding: 100,
				 margin: 50,
	   }
   }
   });
   owlSingleSlider();

   if ( $('.logo-slider').length ) {

	   $('.logo-slider').owlCarousel({
		   center: false,
	   loop: true,
	   stagePadding: 0,
	   margin: 0,
	   smartSpeed: 1000,
	   autoplay: true,
	   autoplayHoverPause: true,
	   dots: false,
	   nav: false,
	   responsive:{
		   400:{
			 items: 2
		   },
		   768:{
			   items: 3
		   },
		   1000:{
			   items: 5
		   }
	   }
	  });
   }

};

var owlSingleSlider = function () {
   if ( $( '.single-slider' ).length ) {
	   $('.single-slider').owlCarousel({
	   center: false,
	   items: 1,
	   loop: true,
	   stagePadding: 0,
	   margin: 0,
	   smartSpeed: 1500,
	   autoplay: true,
	   autoplayHoverPause: true,
	   dots: true,
	   nav: true,
	   navText: ['<span class="icon-keyboard_arrow_left">', '<span class="icon-keyboard_arrow_right">'],

	   responsive:{
		 400:{
		   stagePadding: 0,
				   margin: 0,
		 },
		 600:{
		   stagePadding: 0,
				   margin: 0,
		 }
	   }
	   });
   }
}

var floatingLabel = function () {
   $('.form-control').on('input', function() {
	 var $field = $(this).closest('.form-group');
	 if (this.value) {
	   $field.addClass('field--not-empty');
	 } else {
	   $field.removeClass('field--not-empty');
	 }
   });
};



// scroll
var scrollWindow = function() {
   var lastScrollTop = 0;
   $(window).scroll(function(event){
	   var $w = $(this),
			   st = $w.scrollTop(),
			   navbar = $('.site-nav');
			   // sd = $('.js-scroll-wrap');

	   if (st > 150) {
		   if ( !navbar.hasClass('scrolled') ) {
			   navbar.addClass('scrolled');	
		   }
	   } 
	   if (st < 150) {
		   if ( navbar.hasClass('scrolled') ) {
			   navbar.removeClass('scrolled sleep');
		   }
	   } 
	   if ( st > 350 ) {
		   if ( !navbar.hasClass('awake') ) {
			   navbar.addClass('awake');	
		   } 

		   // hide / show on scroll
		   if (st > lastScrollTop){
		 // downscroll code
		 navbar.removeClass('awake');	
		 navbar.addClass('sleep');	
		  } else {
		 // upscroll code
		 navbar.addClass('awake');	
		  }
		  lastScrollTop = st;
		   

	   }
	   if ( st < 350 ) {
		   if ( navbar.hasClass('awake') ) {
			   navbar.removeClass('awake');
			   navbar.addClass('sleep');
		   }
	   }

  

   });

};


var counter = function() {
   
   $('.section-counter').waypoint( function( direction ) {

	   if( direction === 'down' && !$(this.element).hasClass('ftco-animated') ) {

		   var comma_separator_number_step = $.animateNumber.numberStepFactories.separator(',')
		   $(this.element).find('.number-counter').each(function(){
			   var $this = $(this),
				   num = $this.data('number');
			   $this.animateNumber(
				 {
				   number: num,
				   numberStep: comma_separator_number_step
				 }, 
				 {
					 easing: 'swing',
				   duration: 3000
				 }
			   );
		   });
		   
	   }

   } , { offset: '95%' } );

};


var mobileToggleClick = function() {
   $('.js-menu-toggle').click(function(e) {

	   e.preventDefault();

	 if ( $('body').hasClass('offcanvas') ) {
		 $('body').removeClass('offcanvas');
		 $('.js-menu-toggle').removeClass('active');
		 if ( $('.js-burger-toggle-menu').length ) {
			 $('.js-burger-toggle-menu').removeClass('open');
		 }
	 } else {
		 $('body').addClass('offcanvas');	
		 $('.js-menu-toggle').addClass('active');
		 if ( $('.js-burger-toggle-menu').length ) {
			 $('.js-burger-toggle-menu').addClass('open');
		 }
	 }


 });

 // click outisde offcanvas
   $(document).mouseup(function(e) {
   var container = $(".site-mobile-menu");
   if (!container.is(e.target) && container.has(e.target).length === 0) {
	 if ( $('body').hasClass('offcanvas') ) {
			   $('body').removeClass('offcanvas');
			   $('body').find('.js-menu-toggle').removeClass('active');

			   $('body').find('.js-burger-toggle-menu').removeClass('open');
		   }
   }
   }); 
};



// navigation
var onePageNavigation = function() {
 var navToggler = $('.site-menu-toggle');
	$("body").on("click", ".site-nav .site-nav-ul li a[href^='#'], .smoothscroll[href^='#'], .site-mobile-menu .site-nav-wrap li a[href^='#']", function(e) {
   
   e.preventDefault();

   var $body = $('body');
   if ( $body.hasClass('offcanvas')  ) {
	   $body.removeClass('offcanvas');
	   $('body').find('.js-burger-toggle-menu').removeClass('open');
   }

   var hash = this.hash;
   
	 $('html, body').animate({
	   scrollTop: $(hash).offset().top
	 }, 1000, 'easeInOutExpo');

 });

};


// load ajax page
var portfolioItemClick = function() {
   $('.ajax-load-page').on('click', function(e) {
	   
	   var id = $(this).data('id'),
		   href = $(this).attr('href');

	   if ( $('#portfolio-single-holder > div').length ) {
		   $('#portfolio-single-holder > div').remove();
	   } 

	   TweenMax.to('.loader-portfolio-wrap', 1, { top: '-50px', autoAlpha: 1, display: 'block', ease: Power4.easeOut });

	   $('html, body').animate({
	   scrollTop: $('#portfolio-section').offset().top - 50
	   }, 700, 'easeInOutExpo', function() {
	   });
	   
	   setTimeout(function(){
		   loadPortfolioSinglePage(id, href);
	   }, 100);

	   e.preventDefault();

   });

   // Close
   $('body').on('click', '.js-close-portfolio', function() {

	   setTimeout(function(){
		   $('html, body').animate({
		   scrollTop: $('#portfolio-section').offset().top - 50
		   }, 700, 'easeInOutExpo');
	   }, 200);

	   TweenMax.set('.portfolio-wrapper', { visibility: 'visible', height: 'auto' });
	   TweenMax.to('.portfolio-single-inner', 1, { marginTop: '50px', opacity: 0,  display: 'none', onComplete() {
		   TweenMax.to('.portfolio-wrapper', 1, { marginTop: '0px', autoAlpha: 1, position: 'relative' });

	   } });
	   
   });
};

$(document).ajaxStop(function(){
   setTimeout(function(){
	   TweenMax.to('.loader-portfolio-wrap', 1, { top: '0px', autoAlpha: 0, ease: Power4.easeOut });	
   }, 400);
});

var loadPortfolioSinglePage = function(id, href) {
   $.ajax({
	   url: href,
	   type: 'GET',
	   success: function(html) {

		   TweenMax.to('.portfolio-wrapper', 1, { marginTop: '50px', autoAlpha: 0, visibility: 'hidden', onComplete() {
			   TweenMax.set('.portfolio-wrapper', { height: 0 });
		   } })

		   var pSingleHolder = $('#portfolio-single-holder');
		   
		   var getHTMLContent = $(html).find('.portfolio-single-wrap').html();

		   pSingleHolder.append(
			   '<div id="portfolio-single-'+id+
			   '" class="portfolio-single-inner"><span class="close-portfolio js-close-portfolio d-flex align-items-center"><span class="close-portfolio-label">Back to Portfolio</span><span class="icon-close2 wrap-icon-close"></span></span>' + getHTMLContent + '</div>'
		   );

		   setTimeout(function() {
			   owlSingleSlider();
		   }, 10);

		   setTimeout(function() {
			   TweenMax.set('.portfolio-single-inner', { marginTop: '100px', autoAlpha: 0, display: 'none' });
			   TweenMax.to('.portfolio-single-inner', .5, { marginTop: '0px', autoAlpha: 1, display: 'block', onComplete() {

				   TweenMax.to('.loader-portfolio-wrap', 1, { top: '0px', autoAlpha: 0, ease: Power4.easeOut });	
			   } });
		   }, 700 );
	   }
   });

   return false;

};

var jarallaxPlugin = function() {
   $('.jarallax').jarallax({
   speed: 0.2,
   type: 'scroll-opacity'
   });
   jarallax(document.querySelectorAll('.jarallax-video'), {
   speed: 0.2,
   videoSrc: 'mp4:images/vid1.mp4',
   videoStartTime: 0,
   videoEndTime: 70,
   });
};

var contactForm = function() {
   if ($('#contactForm').length > 0 ) {
	   $( "#contactForm" ).validate( {
		   rules: {
			   name: "required",
			   email: {
			   	email: true
			   }
		   },
		   messages: {
			   name: "V캒 rug캒m introduce탵i un nume. <br> Please enter a name.",
			   email: "Please enter a valid email address"
		   },
		   errorElement: 'span',
		   errorLabelContainer: '.form-error',
		   /* submit via ajax */
		   submitHandler: function(form) {		
			   var $submit = $('.submitting'),
				   waitText = 'Submitting...';

			   $.ajax({   	
				 type: "POST",
				 url: "php/send-email.php",
				 data: $(form).serialize(),

				 beforeSend: function() { 
					 $submit.css('display', 'block').text(waitText);
				 },
				 success: function(msg) {
				  if (msg == 'OK') {
					  $('#form-message-warning').hide();
					   setTimeout(function(){
						  $('#contactForm').fadeOut();
					  }, 1000);
					   setTimeout(function(){
						  $('#form-message-success').fadeIn();   
					  }, 1400);
					  
				   } else {
					  $('#form-message-warning').html(msg);
					   $('#form-message-warning').fadeIn();
					   $submit.css('display', 'none');
				   }
				 },
				 error: function() {
					 $('#form-message-warning').html("Something went wrong. Please try again.");
					$('#form-message-warning').fadeIn();
					$submit.css('display', 'none');
				 }
			 });    		
			 }
		   
	   } );
   }
};

var stickyFillPlugin = function() {
   var elements = document.querySelectorAll('.sticky');
   Stickyfill.add(elements);
};

var animateReveal = function() {


   var controller = new ScrollMagic.Controller();
   
   var greveal = $('.gsap-reveal');

   // gsap reveal
   $('.gsap-reveal').each(function() {
	   $(this).append('<span class="cover"></span>');
   });
   if ( greveal.length ) {
	   var revealNum = 0;
	   greveal.each(function() {
		   var cover = $(this).find('.cover');

		   var tl = new TimelineMax();

		   setTimeout(function() {
			   tl
				   .fromTo(cover, 2, { skewX: 0 }, { xPercent: 101, transformOrigin: "0% 100%", ease:Expo.easeInOut })
		   }, revealNum * 0);
		   
		   var scene = new ScrollMagic.Scene({
			   triggerElement: this,
			   duration: "0%",
			   reverse: false,
			   offset: "-300%",
		   })
		   .setTween(tl)
		   .addTo(controller);

		   revealNum++;

	   });
   }

   // gsap reveal hero
   $('.gsap-reveal-hero').each(function() {
	   var html = $(this).html();
	   $(this).html('<span class="reveal-wrap"><span class="cover"></span><span class="reveal-content">'+html+'</span></span>');
   });
   var grevealhero = $('.gsap-reveal-hero');

   if ( grevealhero.length ) {
	   var heroNum = 0;
	   grevealhero.each(function() {

		   var cover = $(this).find('.cover'),
			   revealContent = $(this).find('.reveal-content');

		   var tl2 = new TimelineMax();

		   setTimeout(function() {

			   tl2
				   .to(cover, 1, { marginLeft: '0', ease:Expo.easeInOut, onComplete() {
					   tl2.set(revealContent, { x: 0 });
					   tl2.to(cover, 1, { marginLeft: '102%', ease:Expo.easeInOut });
				   } } )
		   }, heroNum * 0 );

		   var scene = new ScrollMagic.Scene({
			   triggerElement: this,
			   duration: "0%",
			   reverse: false,
			   offset: "-300%",
		   })
		   .setTween(tl2)
		   .addTo(controller);

		   heroNum++;
	   });
   }

}

